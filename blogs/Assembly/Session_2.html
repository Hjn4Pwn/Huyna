<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Session 2 - Hjn4 Blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/additional.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../homepage.html">HOME - Huy Na</a></li><li class="chapter-item affix "><li class="part-title">ROP Emporium</li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/ret2win_challenge.html">ret2win - challenge 1</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/split_challenge.html">split - challenge 2</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/callme_challenge.html">callme - challenge 3</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/write4_challenge.html">write4 - challenge 4</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/badchars_challenge.html">badchars - challenge 5</a></li><li class="chapter-item affix "><li class="part-title">Pwnable.tw</li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/start_challenge.html">start</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/orw_challenge.html">orw</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/calc_challenge.html">calc</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/3x17_challenge.html">3x17</a></li><li class="chapter-item affix "><li class="part-title">Pico</li><li class="chapter-item "><a href="../../blogs/PWN/Pico/herelibc_challenge.html">Here's a libc </a></li><li class="chapter-item "><a href="../../blogs/PWN/Pico/hijacking_challenge.html">hijacking </a></li><li class="chapter-item affix "><li class="part-title">Pwn from blabla</li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html">handy shellcode</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/pwn07_challenge.html">pwn07 - ret2libc vs ROP</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/got_formatstring_challenge.html">GOT overwrite with format string</a></li><li class="chapter-item affix "><li class="part-title">Assembly</li><li class="chapter-item "><a href="../../blogs/Assembly/Session_1.html">Session 1</a></li><li class="chapter-item expanded "><a href="../../blogs/Assembly/Session_2.html" class="active">Session 2</a></li><li class="chapter-item affix "><li class="part-title">Docker</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hjn4 Blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="session-2"><a class="header" href="#session-2">Session 2</a></h1>
<h3 id="data-movement"><a class="header" href="#data-movement">Data movement</a></h3>
<ul>
<li>
<p>dword = double word = 32 bits</p>
</li>
<li>
<p>qword = 64 bits</p>
</li>
<li>
<p>mov dword [dValue], 27 : như là convert 27 sang giá trị 32bits</p>
</li>
<li>
<p>không thể mov 2 ô nhớ, do đó cần thanh ghi trung gian:</p>
<p>;bAns = bNum
mov al, byte [bNum]
mov [bAns], al</p>
</li>
</ul>
<h3 id="signed-extension"><a class="header" href="#signed-extension">Signed extension</a></h3>
<div class="table-wrapper"><table><thead><tr><th>instruction</th><th>Explanation</th></tr></thead><tbody>
<tr><td>cbw</td><td>convert byte in <strong>al</strong> into word in <strong>ax</strong></td></tr>
<tr><td>cwd</td><td>convert word in <strong>ax</strong> into dword in <strong>dx:ax</strong></td></tr>
<tr><td>cwde</td><td>convert word in <strong>ax</strong> into dword in <strong>eax</strong></td></tr>
<tr><td>cdq</td><td>convert dword in <strong>eax</strong> into qword in <strong>edx:eax</strong></td></tr>
<tr><td>cdqe</td><td>convert dword in <strong>eax</strong> into qword in <strong>rax</strong></td></tr>
<tr><td>cqo</td><td>convert dword in <strong>rax</strong> into qword in <strong>rdx:rax</strong></td></tr>
</tbody></table>
</div>
<p>Lý mà có cwd rồi còn cwde trong khi nó tương tự nhau đều convert sang 32 bits, tuy nhiên nhu cầu xử lý 32bits đã có từ lâu lúc đấy chưa có thanh ghi eax, nên mới dùng cwd giá trị 32bits sẽ được chứa trong cặp dx:ax, tuy nhiên giờ cứ <strong>cwde</strong> mà quất</p>
<p>Còn đây là các lệnh mở rộng hơn mà các vi xử lý sau này mới có:</p>
<ul>
<li>movsx <em><strong>reg16</strong></em> , <em><strong>op8</strong></em></li>
<li>movsx <em><strong>reg32</strong></em> , <em><strong>op8</strong></em></li>
<li>movsx <em><strong>reg32</strong></em> , <em><strong>op16</strong></em></li>
<li>movsx <em><strong>reg64</strong></em> , <em><strong>op8</strong></em></li>
<li>movsx <em><strong>reg64</strong></em> , <em><strong>op16</strong></em></li>
<li>movsxd <em><strong>reg64</strong></em> , <em><strong>op32</strong></em></li>
</ul>
<p><em><strong>op</strong></em> là thanh ghi hay ô nhớ đều được</p>
<h3 id="interger-arithmetic-instruction"><a class="header" href="#interger-arithmetic-instruction">Interger Arithmetic Instruction</a></h3>
<ul>
<li>
<p>add <em><strong>dest</strong></em>, <em><strong>src</strong></em> : 2 toán hạng phải cùng kiểu</p>
</li>
<li>
<p>inc <em><strong>operand</strong></em> : operand += 1</p>
</li>
<li>
<p>sub <em><strong>dest</strong></em>, <em><strong>src</strong></em> : dest = dest - src , cả 2 phải cùng kiểu </p>
</li>
<li>
<p>dec <em><strong>operand</strong></em> : operand -= 1</p>
</li>
</ul>
<p>Nhân chia sẽ khá rắc rối, bởi kết quả nhân có thể vượt quá giới hạn ban đầu mỗi toán hạng</p>
<p><em><strong>Phép nhân số không dấu</strong></em></p>
<ul>
<li>mul <em><strong>src</strong></em></li>
</ul>
<p>Một toán hạng là source, vậy toán hạng còn lại mặc nhiên nằm trong thanh ghi A (al/ax/eax/rax)</p>
<ul>
<li>
<p>case 1: al  * src (op8)  = ah al   &lt;=&gt; ax      = al*op8</p>
</li>
<li>
<p>case 2: ax  * src (op16) = dx ax   &lt;=&gt; dx:ax   = ax*op16</p>
</li>
<li>
<p>case 3: eax * src (op32) = edx eax &lt;=&gt; edx:eax = eax*op32</p>
</li>
<li>
<p>case 4: rax * src (op64) = rdx rax &lt;=&gt; rdx:rax = rax*op64</p>
</li>
</ul>
<p>Tùy theo toán hạng trong src mà lệnh <em>mul</em> sẽ nhân với giá trị lưu trữ tương ứng. Nếu như src là toán hạng 16 bits thì thg mul src nó sẽ đem src nhân với thanh ghi <em><strong>ax</strong></em></p>
<p><em><strong>Phép nhân số có dấu</strong></em></p>
<ul>
<li>imul src ; tương đương với thg không dấu ở trên</li>
<li>imul dest, src/imm32</li>
<li>imul dest, src, imm32 ; dest = src * imm</li>
</ul>
<p>Trường hợp thứ 2 3 thì toán hạng phải nhỏ vì 16bits * 16bits được lưu vào 16 bits do đó nên là nếu nó lớn thì cờ tràn bật lên =&gt; kết quả sai</p>
<p><em><strong>Phép chia</strong></em></p>
<div class="table-wrapper"><table><thead><tr><th>instruction</th><th>Explanation</th></tr></thead><tbody>
<tr><td>div op8(src)</td><td>byte: al(kết quả) = ax/src, số dư lưu vào ah</td></tr>
<tr><td>div op16(src)</td><td>word: ax(kết quả) = dx:ax/src, số dư lưu vào dx</td></tr>
<tr><td>div op32(src)</td><td>double: eax(kết quả) = edx:eax/src, số dư lưu vào edx</td></tr>
<tr><td>div op64(src)</td><td>quad: rax(kết quả) = rdx:rax/src, số dư lưu vào rdx</td></tr>
</tbody></table>
</div>
<p>idiv : với số có dấu cũng tương tự, túm gọn lại là giả dụ <strong>div số 8bit</strong> thì nghiễm nhiên lấy cái giá trị 16 bit tức là dx:ax đem chi cho src(8bits) lúc này cần lưu ý phải xor sạch dx (=0)trong trường hợp số bị chia không phải 16bits.</p>
<p>Còn với việc số bị chia là số âm, thì thay vì để dx = 0 thì ta nên mở rộng số có dấu với các lệnh kiểu như <strong>cbw</strong> thì kết quả chia mới đúng được</p>
<h3 id="logical-operations"><a class="header" href="#logical-operations">Logical operations</a></h3>
<ul>
<li>
<p>and <em><strong>dest</strong></em>, <em><strong>src</strong></em>
x&amp;1 = x ; x&amp;0 = 0 ; có thể &amp;0 để xóa bit đó đi</p>
</li>
<li>
<p>or <em><strong>dest</strong></em>, <em><strong>src</strong></em>
x|1 = 1 ; x|0 = x ; có thể dùng |1 để bật bit lên</p>
</li>
<li>
<p>xor <em><strong>dest</strong></em>, <em><strong>src</strong></em>
0^1 = 1 ; 1^1 = 0 ; có thể dùng lật bit, dùng mã hóa, vì a^b = c; thì c^b = a. </p>
<p>Thêm nữa ta có thể khởi tạo giá trị cho thanh ghi bằng 0, xor ecx, ecx</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../blogs/Assembly/Session_1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../blogs/Assembly/Session_1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
