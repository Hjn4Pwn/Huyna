<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Khái niệm cơ bản - Hjn4 Blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/additional.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../homepage.html">HOME - Huy Na</a></li><li class="chapter-item affix "><li class="part-title">AWS</li><li class="chapter-item "><a href="../../blogs/AWS/job.html">Requirements For Job</a></li><li class="chapter-item "><a href="../../blogs/AWS/EC2.html">Computing Services - EC2</a></li><li class="chapter-item "><a href="../../blogs/AWS/IAM.html">Identity and Access Management -IAM</a></li><li class="chapter-item "><a href="../../blogs/AWS/S3.html">Simple Storage Service - S3</a></li><li class="chapter-item "><a href="../../blogs/AWS/LoadBalancing-Autoscaling.html">Load Balancing and Autoscaling</a></li><li class="chapter-item "><a href="../../blogs/AWS/RDS.html">Relational Database Service - RDS</a></li><li class="chapter-item "><a href="../../blogs/AWS/DynamoDB.html">Database Services - No SQL - DynamoDB</a></li><li class="chapter-item "><a href="../../blogs/AWS/Lambda.html">Serverless Lambda</a></li><li class="chapter-item "><a href="../../blogs/AWS/VPC.html">Networking Service - VPC, Peering, Endpoint</a></li><li class="chapter-item "><a href="../../blogs/AWS/Gateway_Cognito.html">API Gateway & Cognito</a></li><li class="chapter-item "><a href="../../blogs/AWS/CloudFront.html">Content Delivery Service (CDN) - CloudFront</a></li><li class="chapter-item "><a href="../../blogs/AWS/Route_53.html">Domain Name System - Route 53</a></li><li class="chapter-item "><a href="../../blogs/AWS/Monitor_Auditing.html">Monitoring and Auditing - CloudWatch, CloudTrail</a></li><li class="chapter-item "><a href="../../blogs/AWS/Mess.html">Messaging Service - SNS, SQS, SES</a></li><li class="chapter-item "><a href="../../blogs/AWS/Event_Bridge.html">Event Bridge</a></li><li class="chapter-item "><a href="../../blogs/AWS/Elastic_Beanstalk.html">Elastic Beanstalk</a></li><li class="chapter-item "><a href="../../blogs/AWS/Container_Service.html">Container Service - ECS, ECR</a></li><li class="chapter-item "><a href="../../blogs/AWS/IAC_CloudFormation.html">Infra as Code - CloudFormation</a></li><li class="chapter-item "><a href="../../blogs/AWS/Backup_Recovery.html">Backup and Recovery</a></li><li class="chapter-item "><a href="../../blogs/AWS/Sec.html">Security Services</a></li><li class="chapter-item affix "><li class="part-title">Kubernetes</li><li class="chapter-item expanded "><a href="../../blogs/Kubernetes/session1.html" class="active">Khái niệm cơ bản</a></li><li class="chapter-item affix "><li class="part-title">Linux + Git</li><li class="chapter-item "><a href="../../blogs/Linux/bandit.html">Bandit challenge</a></li><li class="chapter-item "><a href="../../blogs/Linux/command_session_1.html">Command session 1</a></li><li class="chapter-item "><a href="../../blogs/Linux/git_command.html">Git command</a></li><li class="chapter-item "><a href="../../blogs/Linux/ssh.html">SSH</a></li><li class="chapter-item affix "><li class="part-title">Docker</li><li class="chapter-item "><a href="../../blogs/Docker/tips.html">Some docker tips for CTF</a></li><li class="chapter-item "><a href="../../blogs/Docker/get_started.html">Basic Docker</a></li><li class="chapter-item "><a href="../../blogs/Docker/image_container.html">Images & Containers: The Core Building Blocks</a></li><li class="chapter-item "><a href="../../blogs/Docker/dockerfile_write.html">Dockerfile</a></li><li class="chapter-item "><a href="../../blogs/Docker/docker_network.html">Docker Network</a></li><li class="chapter-item "><a href="../../blogs/Docker/Volume.html">Volume</a></li><li class="chapter-item "><a href="../../blogs/Docker/Docker_Compose.html">Docker Compose</a></li><li class="chapter-item affix "><li class="part-title">Jenkins</li><li class="chapter-item "><a href="../../blogs/Jenkins/install_by_docker.html">Install Jenkins By Docker</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/link_git_jenkins.html">Link git with jenkins</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/pipline_github_jenkins.html">Pipeline jenkinsfile with github</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/gitlab_jenkins.html">Link gitlab with Jenkins</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/gitlab_dockerhub.html">Gitlab-dockerhub-pipeline</a></li><li class="chapter-item affix "><li class="part-title">Python</li><li class="chapter-item "><a href="../../blogs/Python/RE.html">Regular Expression</a></li><li class="chapter-item "><a href="../../blogs/Python/Automation_1.html">Automation with Python 1</a></li><li class="chapter-item affix "><li class="part-title">Bash script</li><li class="chapter-item "><a href="../../blogs/Bash_script/Variables_Environment.html">Shell Variables and Environment</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Conditionals_Execution.html">Conditionals Execution</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Bash_Loops.html">Bash Loops & Function</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Shell_Redirection.html">Shell Redirection & Pipes and Filters</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Interactive_Scripts.html">Interactive Scripts</a></li><li class="chapter-item affix "><li class="part-title">System and Network Administration</li><li class="chapter-item "><a href="../../blogs/Network/basic_network_1.html">Basic Network 1</a></li><li class="chapter-item affix "><li class="part-title">PWN</li><li class="chapter-item "><a href="../../blogs/PWN/Emporium_ROP.html">Rop Emporium</a></li><li class="chapter-item "><a href="../../blogs/PWN/pwnableTW.html">Pwnable.tw</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pico_CTF.html">Pwn_PicoCTF</a></li><li class="chapter-item "><a href="../../blogs/PWN/PWN_from_blabla.html">Pwn from blabla</a></li><li class="chapter-item affix "><li class="part-title">ROP Emporium</li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/ret2win_challenge.html">ret2win - chall 1</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/split_challenge.html">split - chall 2</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/callme_challenge.html">callme - chall 3</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/write4_challenge.html">write4 - chall 4</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/badchars_challenge.html">badchars - chall 5</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/pivot_challenge.html">pivot - chall 7</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/ret2csu_challenge.html">ret2csu - chall 8</a></li><li class="chapter-item affix "><li class="part-title">Pwnable.tw</li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/start_challenge.html">start</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/orw_challenge.html">orw</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/calc_challenge.html">calc</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/3x17_challenge.html">3x17</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/dubblesort_challenge.html">dubblesort</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/silver_bullet_challenge.html">silver_bullet</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/applestore_challenge.html">applestore</a></li><li class="chapter-item affix "><li class="part-title">Pwn_Pico</li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/herelibc_challenge.html">Here's a libc</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/hijacking_challenge.html">hijacking</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/fermat_strins_challenge.html">fermat_strings</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/Guessgame_challenge.html">Guessgame</a></li><li class="chapter-item affix "><li class="part-title">Pwn from blabla</li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html">handy shellcode</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/pwn07_challenge.html">pwn07 - ret2libc vs ROP</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/got_formatstring_challenge.html">GOT overwrite with format string</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/training.html">training</a></li><li class="chapter-item affix "><li class="part-title">Assembly</li><li class="chapter-item "><a href="../../blogs/Assembly/ASM.html">ASM</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_1.html">Session 1</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_2.html">Session 2</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_3.html">Session 3</a></li><li class="chapter-item affix "><li class="part-title">RE_PicoCTF</li><li class="chapter-item "><a href="../../blogs/RE/RE.html">RE</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_0.html">ARMssembly 0</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_1.html">ARMssembly 1</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_2.html">ARMssembly 2</a></li><li class="chapter-item affix "><li class="part-title">Documents from everywhere</li><li class="chapter-item "><a href="../../blogs/Documents/troubleshooting.html">Troubleshooting</a></li><li class="chapter-item "><a href="../../blogs/Documents/study.html">Study</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hjn4 Blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="khái-niệm-cơ-bản"><a class="header" href="#khái-niệm-cơ-bản">Khái niệm cơ bản</a></h1>
<h2 id="cluster-architecture"><a class="header" href="#cluster-architecture">Cluster Architecture</a></h2>
<p><img src="./image/ss1_cluster.png" alt="alt text" /></p>
<p>Cluster gồm 2 thành phần:</p>
<ul>
<li>Control Plane: Có nhiệm vụ điều phối toàn bộ hoạt động của cluster</li>
<li>Data Plane:
<ul>
<li>Giúp triển khai service</li>
<li>Gồm nhiều worker node</li>
</ul>
</li>
</ul>
<p><img src="./image/k8s_architect.png" alt="alt text" /></p>
<h3 id="control-plane"><a class="header" href="#control-plane">Control Plane</a></h3>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/">Reference</a></p>
</li>
<li>
<p><strong>kube-apiserver:</strong>: Cho phép quản lý API trong cluster, khi client (CLI interface), Agents, gọi đến cluster, cần lấy thông tin trong cluster thì sẽ gọi đến API Server này. API Server sẽ tiến hành xác thực, phân quyền. Mọi thứ đều phải tương tác qua API Server</p>
</li>
<li>
<p><strong>kube-controller-manager</strong>: Bất kì một controler nào trong cluster k8s đều làm nhiệm vụ monitor một đối tượng nào đó rồi đưa ra hành động tương ứng. Example: quản lý replicaset</p>
</li>
<li>
<p><strong>Scheduler</strong>: Khi mà ta muốn chạy 1 service, thì scheduler sẽ tiến hành tìm các Node hợp lệ (thỏa mản các ràng buộc và có sẵn các tài nguyên cần thiết). Scheduler sẽ rank các valid nodes rồi gán Pod với node hợp lệ</p>
</li>
<li>
<p><strong>etcd</strong>: Như là 1 database chứa toàn bộ data của cluster (objects, resources,...) phục vụ cho mục đích truy cập và tra cứu</p>
</li>
<li>
<p><strong>cloud-controller-manager</strong>(<em>optional</em>): Khi mà ta tự tạo riêng 1 cái cluster k8s nhưng lại muốn sử dụng các tài nguyên như (EC2, S3, ...) trên cloud nói chung, AWS nói riêng thì ta cần đến CCM để có thể tương tác với các service của cloud
<img src="./image/k8s_maternode.png" alt="alt text" /></p>
</li>
</ul>
<h3 id="data-plane"><a class="header" href="#data-plane">Data Plane</a></h3>
<p>Gồm nhiều woker node, trong các woker node thì có 2 thành phần chính:</p>
<ul>
<li><strong>Kubelet</strong>: Như là 1 Agent có trách nhiệm checkin các resource chạy trên woker node(Pod,...) cập nhật thông tin lên API Server, nhận lệnh từ API Server và triển khai trên woker node. Đảm bảo các containers trên các Pod chạy ổn định</li>
<li><strong>Kube-Proxy</strong>: Tạo ra các rule để instance, pod connect với nhau</li>
<li><strong>Container Runtime</strong>: Container runtime là một phần mềm chịu trách nhiệm cho việc quản lý và chạy các container. Nó là một thành phần cụ thể của hệ thống có nhiệm vụ thực hiện các chức năng như tạo, khởi động, dừng và xóa container. Một số container runtime phổ biến trong cộng đồng Kubernetes bao gồm Docker, containerd, rkt, và CRI-O.</li>
<li><strong>Container Runtime Interface</strong>: CRI là một giao diện chuẩn để tương tác giữa Kubernetes và các container runtime. Nó giúp tách biệt logic quản lý container của Kubernetes với container runtime cụ thể, cho phép linh hoạt trong việc thay đổi hoặc sử dụng nhiều container runtime khác nhau.</li>
</ul>
<h2 id="yaml"><a class="header" href="#yaml">YAML</a></h2>
<ul>
<li>Example Json:</li>
</ul>
<pre><code class="language-py">data = {
  &quot;id&quot;: &quot;AWcvsjx864kVeDHDi2gB&quot;,
  &quot;timestamp&quot;: 1542693469197,
  &quot;description&quot;: &quot;This network device leaf2.abc.inc is unreachable from controller. The device role is ACCESS.&quot;,
  &quot;actualServiceId&quot;: &quot;10.10.20.82&quot;,
  &quot;assignedTo&quot;: &quot;&quot;,
  &quot;enrichmentInfo&quot;: {
    &quot;issueDetails&quot;: {
      &quot;issue&quot;: [
        {
          &quot;issueId&quot;: &quot;AWcvsjx864kVeDHDi2gB&quot;,
          &quot;issuePriority&quot;: &quot;&quot;,
          &quot;issueSummary&quot;: &quot;Network Device 10.10.20.82 Is Unreachable From Controller&quot;,
          &quot;issueTimestamp&quot;: 1542693469197,
          &quot;suggestedActions&quot;: [
            {
              &quot;message&quot;: &quot;From the controller, verify whether the last hop is reachable.&quot;,
              &quot;steps&quot;: []
            },
            {
              &quot;message&quot;: &quot;Verify access to the device.&quot;,
              &quot;steps&quot;: []
            }
          ],
          &quot;impactedHosts&quot;: [
            {
              &quot;hostName&quot;: &quot;DUT&quot;,
              &quot;failedAttempts&quot;: 3,
              &quot;location&quot;: {
                &quot;siteId&quot;: &quot;SanJose&quot;,
                &quot;apsImpacted&quot;: []
              },
              &quot;timestamp&quot;: 1542693469197
            }
          ]
        }
      ]
    },
    &quot;connectedDevice&quot;: [
      {
        &quot;deviceDetails&quot;: {
          &quot;inventoryStatusDetail&quot;: &quot;&lt;status&gt;&lt;general code=\&quot;SNMP_TIMEOUT\&quot;/&gt;&lt;/status&gt;&quot;,
          &quot;lastUpdateTime&quot;: 1542693255158,
          &quot;errorDescription&quot;: &quot;SNMP timeouts are occurring with this device. Either the SNMP credentials are not correctly provided to controller or the device is responding slow and snmp timeout is low. If its a timeout issue, controller will attempt to progressively adjust the timeout in subsequent collection cycles to get device to managed state. User can also run discovery again only for this device using the discovery feature after adjusting the timeout and snmp credentials as required. Or user can update the timeout and snmp credentials as required using update credentials.&quot;,
          &quot;tagCount&quot;: &quot;0&quot;,
          &quot;lastUpdated&quot;: &quot;2018-11-20 05:54:15&quot;,
          &quot;id&quot;: &quot;a7633ae5-d3c9-4aea-837d-c3ad5b19c802&quot;,
          &quot;neighborTopology&quot;: [
            {
              &quot;errorCode&quot;: 5000,
              &quot;message&quot;: &quot;An internal has error occurred while processing this request.&quot;,
            }
          ],
          &quot;cisco360view&quot;: &quot;https://10.10.20.22/dna/assurance/home#networkDevice/a7633ae5-d3c9-4aea-837d-c3ad5b19c802&quot;
        }
      }
    ]
  }
}

</code></pre>
<ul>
<li>Convert from json to yaml</li>
</ul>
<pre><code class="language-py">JSON
{
  Servers: [
     {
        name: Server1
        owner: John
        created: 2021
        status: Active
     },
    {
        name: Server2
        owner: Huy 
        created: 2024
        status: Active
     }
  ]
}

YAML
Servers:
  - name: Server1
    owner: John
    created: 2021
    status: Active
  - name: Server2
    owner: Huy
    created: 2024
    status: Active

</code></pre>
<ul>
<li>YAML thường được sử dụng làm ngôn ngữ định nghĩa cấu hình</li>
<li>Data Structure:
<img src="./image/ss1_yaml_1.png" alt="alt text" /></li>
<li>YAML Ain't Markup Language (YAML) là tập cha của JSON, được thiết kế để dễ đọc hơn.</li>
<li>Vì là tập cha của JSON nên các bộ phân tích YAML có thể phân tích các tệp JSON (nhưng ngược lại thì không).</li>
<li>Do vậy, YAML tốt hơn JSON ở một số tác vụ, bao gồm việc nhúng trực tiếp mã JSON (có chứa dấu ngoặc kép) trong các file YAML.</li>
<li>YAML sử dụng thụt lề để xác định phân cấp trong tệp.</li>
<li>Maps và danh sách (list) cũng có thể được biểu diễn khá tương tự như trong JavaScript hoặc Python, dưới dạng gọi là “flow syntax” – cú pháp luồng.</li>
</ul>
<pre><code class="language-js">person:
  name: John
  age: 30
  city: New York


person: {name: John, age: 30, city: New York}

</code></pre>
<pre><code class="language-js">fruits:
  - apple
  - orange
  - banana


fruits: [apple, orange, banana]

</code></pre>
<pre><code class="language-js">people:
  - name: John
    age: 30
    city: New York
  - name: Jane
    age: 25
    city: London


people:
  - {name: John, age: 30, city: New York}
  - {name: Jane, age: 25, city: London}

</code></pre>
<h2 id="pod"><a class="header" href="#pod">POD</a></h2>
<ul>
<li>Là một đối tượng nhỏ nhất được tạo ra bởi k8s</li>
<li>Dùng để đóng gói các Containers vào bên trong</li>
<li>Là một instance của application</li>
<li>Khi Pod đang running nó là thực thể không thể thay đổi (thêm, xóa, sửa)</li>
<li>Scale workload =&gt; tăng Pod =&gt; tăng Host
<img src="./image/ss1_pod_scale.png" alt="alt text" /></li>
<li>Multiple Container in Pod
<img src="./image/ss1_multi_con_pod.png" alt="alt text" />
<ul>
<li><strong>Sidecar Container</strong>: container running song song với container application</li>
<li><strong>Init Container</strong>: container running trước container application</li>
</ul>
</li>
<li>Chỉ nên chạy 1 container trong 1 pod</li>
</ul>
<h2 id="install"><a class="header" href="#install">Install</a></h2>
<h3 id="install-kubectl-on-ubuntu"><a class="header" href="#install-kubectl-on-ubuntu">Install kubectl on ubuntu</a></h3>
<pre><code class="language-py">curl -LO &quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;

sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl

kubectl version --client

</code></pre>
<h2 id="install-minikube"><a class="header" href="#install-minikube">Install MiniKube</a></h2>
<pre><code class="language-sh">sudo apt update -y
sudo apt upgrade -y

sudo reboot
sudo apt install -y curl wget apt-transport-https

curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64

sudo install minikube-linux-amd64 /usr/local/bin/minikube

minikube version

</code></pre>
<h2 id="deploy"><a class="header" href="#deploy">Deploy</a></h2>
<ul>
<li>Cần start minikube:</li>
</ul>
<pre><code class="language-sh">minikube start --driver=docker

minikube status
</code></pre>
<ul>
<li>Khi ta create 1 object, kubectl sẽ tự động gửi câu lệnh này cho virtual host, virtual host nó đi tìm image này nó sẽ tìm trên dockerhub, do đó ta cần push image lên dockerhub</li>
</ul>
<blockquote>
<p>kubectl create deployment first-app --image=kube-test</p>
</blockquote>
<p>Kiểm tra cho thấy create object không thành công:</p>
<pre><code class="language-sh">➜ kub-action-01-starting-setup ⚡                                       20.8.0  07:29:45
▶ kubectl get deployment
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
first-app   0/1     1            0           53s

➜ kub-action-01-starting-setup ⚡                                       20.8.0  07:29:55
▶ kubectl get pod
NAME                        READY   STATUS             RESTARTS   AGE
first-app-f975696fc-fhzqh   0/1     ImagePullBackOff   0          60s

# Do là chưa Ready nên cần push image lên 
➜ kub-action-01-starting-setup ⚡                                       20.8.0  07:30:02
▶ kubectl delete deployment first-app
deployment.apps &quot;first-app&quot; deleted

</code></pre>
<blockquote>
<p>minikube dashboard # for monitor</p>
</blockquote>
<p><img src="./image/dashboard_minikube.png" alt="alt text" /></p>
<h3 id="how-kubectl-work"><a class="header" href="#how-kubectl-work">How kubectl work?</a></h3>
<p><img src="./image/kubectl_work.png" alt="alt text" /></p>
<h2 id="the-service-object"><a class="header" href="#the-service-object">The &quot;Service&quot; Object</a></h2>
<p><img src="./image/service_object.png" alt="alt text" /></p>
<ul>
<li>
<p>&quot;Service&quot; Object có thể giúp các pod communicate với nhau thông qua name, giúp các service group pods có thể có 1 đại chỉ IP không đổi dù các pods bên trong có thay đổi</p>
</li>
<li>
<p>Tạo service mới, nhằm tạo cách có thể truy cập đến một deployment cụ thể:</p>
</li>
</ul>
<blockquote>
<p>kubectl expose deployment kube-app --type=LoadBalancer --port=8080</p>
</blockquote>
<ul>
<li><strong>X</strong>: ClusterIP, LoadBalancer, NodePort, ...</li>
<li><strong>LoadBalancer</strong> yêu cầu được tạo trước đó</li>
<li><strong>--port=8080</strong>: Mở cổng 8080 trên dịch vụ. Các yêu cầu được chuyển đến cổng này sẽ được chuyển tiếp đến các Pod thuộc Deployment &quot;first-app&quot; trên cổng mà Deployment đang lắng nghe (trong trường hợp này, cổng 8080).</li>
<li><strong>ClusterIP</strong>: Dịch vụ mặc định khi không chỉ định --type nào. Nó tạo ra một địa chỉ IP nội bộ trong cụm Kubernetes và chỉ có thể truy cập từ bên trong cụm. Đây là loại dịch vụ nhanh và phổ biến nhất.</li>
<li><strong>ExternalName</strong>: Liên kết dịch vụ với một tên DNS bên ngoài. Không tạo ra địa chỉ IP nội bộ và không có load balancing. Thường được sử dụng để kết nối với các dịch vụ bên ngoài cụm Kubernetes</li>
<li><strong>LoadBalancer</strong>: Tạo ra một LoadBalancer và gán một địa chỉ IP công cộng cho dịch vụ. Các yêu cầu được chuyển tiếp từ LoadBalancer đến các Pod thuộc dịch vụ.</li>
<li><strong>NodePort</strong>:
<ul>
<li>Khi bạn tạo một dịch vụ NodePort và kết nối nó với một Deployment, tất cả các Pod thuộc Deployment đó sẽ chia sẻ cùng một cổng NodePort trên mỗi node. Mỗi Pod không có cổng riêng lẻ được mở, và không có cách để yêu cầu từ một Pod cụ thể được chuyển tiếp đến một Pod khác trong cùng một Deployment thông qua cổng NodePort.</li>
<li>Ví dụ, nếu bạn có một Deployment với nhiều Pod, và tạo một dịch vụ NodePort cho Deployment đó, cổng NodePort sẽ chuyển tiếp yêu cầu đến bất kỳ Pod nào thuộc Deployment đó. Nó không sẽ chuyển tiếp yêu cầu từ một Pod cụ thể đến Pod khác cụ thể trong Deployment.</li>
</ul>
</li>
</ul>
<pre><code class="language-sh">➜ kub-action-01-starting-setup ⚡                                       20.8.0  14:33:21
▶ kubectl expose deployment kube-app --type=LoadBalancer --port=8080
service/kube-app exposed

➜ kub-action-01-starting-setup ⚡                                       20.8.0  14:33:30
▶ kubectl get service
NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kube-app     LoadBalancer   10.102.88.140   &lt;pending&gt;     8080:31310/TCP   34s
kubernetes   ClusterIP      10.96.0.1       &lt;none&gt;        443/TCP          3h4m

</code></pre>
<ul>
<li>ClusterIP is default</li>
<li>Trong minikube thì đây là 1 virtual host do đó thì external-ip sẽ luôn pending như vậy.</li>
</ul>
<pre><code class="language-sh">➜ kub-action-01-starting-setup ⚡                                       20.8.0  14:34:05
▶ minikube service kube-app
|-----------|----------|-------------|---------------------------|
| NAMESPACE |   NAME   | TARGET PORT |            URL            |
|-----------|----------|-------------|---------------------------|
| default   | kube-app |        8080 | http://192.168.67.2:31310 |
|-----------|----------|-------------|---------------------------|
🏃  Starting tunnel for service kube-app.
|-----------|----------|-------------|------------------------|
| NAMESPACE |   NAME   | TARGET PORT |          URL           |
|-----------|----------|-------------|------------------------|
| default   | kube-app |             | http://127.0.0.1:43719 |
|-----------|----------|-------------|------------------------|
🎉  Opening service default/kube-app in default browser...

# or
➜ Application ⚡                                                                                                    15:34:59
▶ minikube service kube-app --url
http://127.0.0.1:43815
❗  Because you are using a Docker driver on linux, the terminal needs to be open to run it.

</code></pre>
<ul>
<li>Có khả năng tự restart nếu pod bị fail, để duy trì tính ổn định của ứng dụng.</li>
</ul>
<h2 id="scale"><a class="header" href="#scale">Scale</a></h2>
<pre><code class="language-sh">➜ ~ ⚡                                                                           19:40:47
▶ kubectl scale deployment/kube-app --replicas=3
deployment.apps/kube-app scaled

➜ ~ ⚡                                                                           19:40:53
▶ kubectl get pods
NAME                        READY   STATUS              RESTARTS      AGE
kube-app-57cdbc557f-8t6bc   0/1     ContainerCreating   0             2s
kube-app-57cdbc557f-g97wk   1/1     Running             3 (52m ago)   8h
kube-app-57cdbc557f-hnhw6   0/1     ContainerCreating   0             2s

➜ ~ ⚡                                                                           19:40:55
▶ kubectl get pods
NAME                        READY   STATUS    RESTARTS      AGE
kube-app-57cdbc557f-8t6bc   1/1     Running   0             19s
kube-app-57cdbc557f-g97wk   1/1     Running   3 (53m ago)   8h
kube-app-57cdbc557f-hnhw6   1/1     Running   0             19s

</code></pre>
<p><img src="./image/scale_pods.png" alt="alt text" /></p>
<ul>
<li>Do là trước đó ta add service type LoadBalancer =&gt; các pods này cũng có load</li>
</ul>
<p><img src="./image/loadbalance_scale.png" alt="alt text" /></p>
<h2 id="update-new-version"><a class="header" href="#update-new-version">Update new version</a></h2>
<p><em><strong>Note: không thể update image với 1 tên khác hay là 1 cái tech khác</strong></em></p>
<ul>
<li>Lệnh này được sử dụng để cập nhật image của container trong một Deployment trong Kubernetes. Trong trường hợp này, kube-app=/hjn4... kube-app ở đây là tên container</li>
</ul>
<p><em>Note: Cần lưu ý một vấn đề là tag version phải khác version trước, bởi vì nếu giống nhau nó sẽ k download về</em></p>
<blockquote>
<p>kubectl set image deployment/kube-app kube-app=hjn4/kube-app:v2</p>
</blockquote>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:13:20
▶ kubectl set image deployment/kube-app kube-app=hjn4/kube-app:v2
deployment.apps/kube-app image updated

</code></pre>
<ul>
<li>Lệnh này được sử dụng để theo dõi trạng thái của quá trình triển khai (rollout) sau khi bạn đã thực hiện việc cập nhật image hoặc thay đổi khác trong một Deployment.</li>
</ul>
<blockquote>
<p>kubectl rollout status deployment/kube-app</p>
</blockquote>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:13:56
▶ kubectl rollout status deployment/kube-app
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 2 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 2 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 2 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 old replicas are pending termination...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 old replicas are pending termination...
deployment &quot;kube-app&quot; successfully rolled out

</code></pre>
<h2 id="rollback--history"><a class="header" href="#rollback--history">Rollback &amp; history</a></h2>
<ul>
<li>Chúng ta giả lập version lỗi, update image với tag không tồn tại:</li>
</ul>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:14:10
▶ kubectl set image deployment/kube-app kube-app=hjn4/kube-app:3
deployment.apps/kube-app image updated
➜ ~ ⚡                                                                           20:37:52
▶ kubectl rollout status deployment/kube-app
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...
Waiting for deployment &quot;kube-app&quot; rollout to finish: 1 out of 3 new replicas have been updated...

</code></pre>
<p><img src="./image/rollback_failed_version.png" alt="alt text" /></p>
<ul>
<li>Hoàn tác việc triển khai version mới nhất:</li>
</ul>
<blockquote>
<p>kubectl rollout undo deployment/kube-app</p>
</blockquote>
<ul>
<li>
<p>Check các version update và rollback về trạng thái chỉ định trong quá khứ:</p>
</li>
<li>
<p>xem các trạng thái trước đó</p>
</li>
</ul>
<blockquote>
<p>kubectl rollout history deployment/kube-app</p>
</blockquote>
<ul>
<li>xem chi tiết 1 cụ thể 1 trạng thái</li>
</ul>
<blockquote>
<p>kubectl rollout history deployment/kube-app --revision=1</p>
</blockquote>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:42:27
▶ kubectl rollout history deployment/kube-app
deployment.apps/kube-app
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
3         &lt;none&gt;
4         &lt;none&gt;

➜ ~ ⚡                                                                           20:43:26
▶ kubectl rollout history deployment/kube-app --revision=1
deployment.apps/kube-app with revision #1
Pod Template:
  Labels:       app=kube-app
        pod-template-hash=57cdbc557f
  Containers:
   kube-app:
    Image:      hjn4/kube-app
    Port:       &lt;none&gt;
    Host Port:  &lt;none&gt;
    Environment:        &lt;none&gt;
    Mounts:     &lt;none&gt;
  Volumes:      &lt;none&gt;

</code></pre>
<ul>
<li>Rollback về quá khứ:</li>
</ul>
<blockquote>
<p>kubectl rollout undo deployment/kube-app --to-revision=1</p>
</blockquote>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:44:22
▶ kubectl rollout undo deployment/kube-app --to-revision=1
deployment.apps/kube-app rolled back

</code></pre>
<h3 id="tại-sao-không-thấy-downtime-trong-quá-trình-rollback"><a class="header" href="#tại-sao-không-thấy-downtime-trong-quá-trình-rollback">Tại sao không thấy downtime trong quá trình rollback</a></h3>
<ul>
<li><strong>Rolling Update Strategy</strong>: Kubernetes sử dụng chiến lược cập nhật cuộn (Rolling Update) mặc định khi bạn thực hiện các thay đổi trong một Deployment. Điều này có nghĩa là nó sẽ tạo ra các bản sao mới của Pods, loại bỏ từng Pod cũ một cách dần dần để đảm bảo rằng ít nhất một số lượng Pods luôn hoạt động trong suốt quá trình triển khai.</li>
<li><strong>Pods Cũ Và Mới Hoạt Động Đồng Thời</strong>: Trong quá trình cuộn chảy, có một khoảng thời gian khi cả các Pods cũ và mới đều hoạt động đồng thời. Kubernetes đảm bảo rằng số lượng Pods hoạt động không bao giờ giảm xuống dưới một mức nhất định, nhờ đó giảm thiểu hoặc loại bỏ downtime.</li>
<li><strong>Health Checks</strong>: Kubernetes sử dụng các kiểm tra sức khỏe (health checks) để đảm bảo rằng mỗi Pod mới được triển khai được xem là &quot;sẵn sàng&quot; trước khi loại bỏ một Pod cũ. Điều này giúp đảm bảo rằng chỉ có các Pods sẵn sàng và lành mạnh được giữ lại.</li>
<li><strong>Pod Disruption Budgets</strong>: Nếu bạn đã cấu hình Pod Disruption Budget trong Deployment, Kubernetes sẽ giữ lại một số lượng Pods hoạt động tối thiểu trong quá trình triển khai hoặc quay lại phiên bản trước đó.</li>
</ul>
<h3 id="delete"><a class="header" href="#delete">Delete</a></h3>
<pre><code class="language-sh">➜ ~ ⚡                                                                           20:45:57
▶ kubectl delete service kube-app
service &quot;kube-app&quot; deleted
➜ ~ ⚡                                                                           20:52:49
▶ kubectl delete deployment kube-app
deployment.apps &quot;kube-app&quot; deleted

➜ ~ ⚡                                                                           20:53:00
▶ kubectl get deployment
No resources found in default namespace.

➜ ~ ⚡                                                                           20:53:07
▶ kubectl get pod
NAME                        READY   STATUS        RESTARTS   AGE
kube-app-57cdbc557f-99ftg   1/1     Terminating   0          7m16s
kube-app-57cdbc557f-k8fx9   1/1     Terminating   0          7m10s
kube-app-57cdbc557f-z8nl9   1/1     Terminating   0          7m13s
➜ ~ ⚡                                                                           20:53:13
▶ kubectl get pod
No resources found in default namespace.
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../blogs/AWS/Sec.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../blogs/Linux/bandit.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../blogs/AWS/Sec.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../blogs/Linux/bandit.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
