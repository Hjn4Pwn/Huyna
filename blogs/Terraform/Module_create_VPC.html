<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js dark">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Terraform Module: Create VPC on AWS - Hjn4 Blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/css/additional.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../../homepage.html">HOME - Huy Na</a></li><li class="chapter-item affix "><li class="part-title">AWS</li><li class="chapter-item "><a href="../../blogs/AWS/job.html">Requirements For Job</a></li><li class="chapter-item "><a href="../../blogs/AWS/EC2.html">Computing Services - EC2</a></li><li class="chapter-item "><a href="../../blogs/AWS/IAM.html">Identity and Access Management -IAM</a></li><li class="chapter-item "><a href="../../blogs/AWS/S3.html">Simple Storage Service - S3</a></li><li class="chapter-item "><a href="../../blogs/AWS/LoadBalancing-Autoscaling.html">Load Balancing and Autoscaling</a></li><li class="chapter-item "><a href="../../blogs/AWS/RDS.html">Relational Database Service - RDS</a></li><li class="chapter-item "><a href="../../blogs/AWS/DynamoDB.html">Database Services - No SQL - DynamoDB</a></li><li class="chapter-item "><a href="../../blogs/AWS/Lambda.html">Serverless Lambda</a></li><li class="chapter-item "><a href="../../blogs/AWS/VPC.html">Networking Service - VPC, Peering, Endpoint</a></li><li class="chapter-item "><a href="../../blogs/AWS/Gateway_Cognito.html">API Gateway & Cognito</a></li><li class="chapter-item "><a href="../../blogs/AWS/CloudFront.html">Content Delivery Service (CDN) - CloudFront</a></li><li class="chapter-item "><a href="../../blogs/AWS/Route_53.html">Domain Name System - Route 53</a></li><li class="chapter-item "><a href="../../blogs/AWS/Monitor_Auditing.html">Monitoring and Auditing - CloudWatch, CloudTrail</a></li><li class="chapter-item "><a href="../../blogs/AWS/Mess.html">Messaging Service - SNS, SQS, SES</a></li><li class="chapter-item "><a href="../../blogs/AWS/Event_Bridge.html">Event Bridge</a></li><li class="chapter-item "><a href="../../blogs/AWS/Elastic_Beanstalk.html">Elastic Beanstalk</a></li><li class="chapter-item "><a href="../../blogs/AWS/Container_Service.html">Container Service - ECS, ECR</a></li><li class="chapter-item "><a href="../../blogs/AWS/IAC_CloudFormation.html">Infra as Code - CloudFormation</a></li><li class="chapter-item "><a href="../../blogs/AWS/Backup_Recovery.html">Backup and Recovery</a></li><li class="chapter-item "><a href="../../blogs/AWS/Sec.html">Security Services</a></li><li class="chapter-item affix "><li class="part-title">PHP</li><li class="chapter-item "><a href="../../blogs/PHP/setup_env.html">Setup Environment</a></li><li class="chapter-item "><a href="../../blogs/PHP/basic.html">Basic Concepts</a></li><li class="chapter-item "><a href="../../blogs/PHP/mysqli.html">MySQLi</a></li><li class="chapter-item "><a href="../../blogs/PHP/sort_algorithms.html">Sort Algorithms</a></li><li class="chapter-item "><a href="../../blogs/PHP/hackerrank_algorithms.html">Hackerrank</a></li><li class="chapter-item "><a href="../../blogs/PHP/Interview.html">Interview</a></li><li class="chapter-item affix "><li class="part-title">Laravel</li><li class="chapter-item "><a href="../../blogs/Laravel/setup_env.html">Setup Environment</a></li><li class="chapter-item "><a href="../../blogs/Laravel/artisanCommand.html">Artisan Command</a></li><li class="chapter-item "><a href="../../blogs/Laravel/Takenote.html">Take note 1</a></li><li class="chapter-item "><a href="../../blogs/Laravel/Takenote2.html">Take note 2</a></li><li class="chapter-item "><a href="../../blogs/Laravel/Takenote3.html">Take note 3</a></li><li class="chapter-item "><a href="../../blogs/Laravel/Takenote4.html">Take note 4</a></li><li class="chapter-item "><a href="../../blogs/Laravel/advance_concepts.html">Advance Concepts</a></li><li class="chapter-item "><a href="../../blogs/Laravel/database.html">Database</a></li><li class="chapter-item "><a href="../../blogs/Laravel/explain_functions.html">Explain Functions</a></li><li class="chapter-item affix "><li class="part-title">Kubernetes</li><li class="chapter-item "><a href="../../blogs/Kubernetes/session1.html">Basic Concepts</a></li><li class="chapter-item "><a href="../../blogs/Kubernetes/commands.html">Practice on KodeKloud</a></li><li class="chapter-item "><a href="../../blogs/Kubernetes/minkube_deployment.html">MiniKube Deployment</a></li><li class="chapter-item "><a href="../../blogs/Kubernetes/data_volume.html">Manage Data & Volumes</a></li><li class="chapter-item "><a href="../../blogs/Kubernetes/network.html">Network</a></li><li class="chapter-item affix "><li class="part-title">Linux + Git</li><li class="chapter-item "><a href="../../blogs/Linux/bandit.html">Bandit challenge</a></li><li class="chapter-item "><a href="../../blogs/Linux/command_session_1.html">Command session 1</a></li><li class="chapter-item "><a href="../../blogs/Linux/git_command.html">Git command</a></li><li class="chapter-item "><a href="../../blogs/Linux/ssh.html">SSH</a></li><li class="chapter-item "><a href="../../blogs/Linux/conda.html">Conda</a></li><li class="chapter-item affix "><li class="part-title">Docker</li><li class="chapter-item "><a href="../../blogs/Docker/tips.html">Some docker tips for CTF</a></li><li class="chapter-item "><a href="../../blogs/Docker/get_started.html">Basic Docker</a></li><li class="chapter-item "><a href="../../blogs/Docker/image_container.html">Images & Containers: The Core Building Blocks</a></li><li class="chapter-item "><a href="../../blogs/Docker/dockerfile_write.html">Dockerfile</a></li><li class="chapter-item "><a href="../../blogs/Docker/docker_network.html">Docker Network</a></li><li class="chapter-item "><a href="../../blogs/Docker/Volume.html">Volume</a></li><li class="chapter-item "><a href="../../blogs/Docker/Docker_Compose.html">Docker Compose</a></li><li class="chapter-item affix "><li class="part-title">Terraform</li><li class="chapter-item "><a href="../../blogs/Terraform/overview.html">Overview</a></li><li class="chapter-item "><a href="../../blogs/Terraform/functional_pro.html">Functional Programming</a></li><li class="chapter-item expanded "><a href="../../blogs/Terraform/Module_create_VPC.html" class="active">Terraform Module: Create VPC on AWS</a></li><li class="chapter-item affix "><li class="part-title">Jenkins</li><li class="chapter-item "><a href="../../blogs/Jenkins/install_by_docker.html">Install Jenkins By Docker</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/link_git_jenkins.html">Link git with jenkins</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/pipline_github_jenkins.html">Pipeline jenkinsfile with github</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/gitlab_jenkins.html">Link gitlab with Jenkins</a></li><li class="chapter-item "><a href="../../blogs/Jenkins/gitlab_dockerhub.html">Gitlab-dockerhub-pipeline</a></li><li class="chapter-item affix "><li class="part-title">CSS</li><li class="chapter-item "><a href="../../blogs/CSS/basic.html">Basic Concepts</a></li><li class="chapter-item "><a href="../../blogs/CSS/flexbox.html">Flexbox CSS</a></li><li class="chapter-item "><a href="../../blogs/CSS/BEM.html">BEM</a></li><li class="chapter-item "><a href="../../blogs/CSS/responsive.html">Resposive</a></li><li class="chapter-item "><a href="../../blogs/CSS/tranform_sitsion_anima.html">Transform - Transition - Animation</a></li><li class="chapter-item affix "><li class="part-title">JS</li><li class="chapter-item "><a href="../../blogs/JS/basic.html">Basic Concepts 1</a></li><li class="chapter-item "><a href="../../blogs/JS/dom.html">DOM</a></li><li class="chapter-item "><a href="../../blogs/JS/basic2.html">Basic Concepts 2</a></li><li class="chapter-item affix "><li class="part-title">Python</li><li class="chapter-item "><a href="../../blogs/Python/RE.html">Regular Expression</a></li><li class="chapter-item "><a href="../../blogs/Python/Automation_1.html">Automation with Python 1</a></li><li class="chapter-item affix "><li class="part-title">Bash script</li><li class="chapter-item "><a href="../../blogs/Bash_script/Variables_Environment.html">Shell Variables and Environment</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Conditionals_Execution.html">Conditionals Execution</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Bash_Loops.html">Bash Loops & Function</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Shell_Redirection.html">Shell Redirection & Pipes and Filters</a></li><li class="chapter-item "><a href="../../blogs/Bash_script/Interactive_Scripts.html">Interactive Scripts</a></li><li class="chapter-item affix "><li class="part-title">System and Network Administration</li><li class="chapter-item "><a href="../../blogs/Network/basic_network_1.html">Basic Network 1</a></li><li class="chapter-item affix "><li class="part-title">PWN</li><li class="chapter-item "><a href="../../blogs/PWN/Emporium_ROP.html">Rop Emporium</a></li><li class="chapter-item "><a href="../../blogs/PWN/pwnableTW.html">Pwnable.tw</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pico_CTF.html">Pwn_PicoCTF</a></li><li class="chapter-item "><a href="../../blogs/PWN/PWN_from_blabla.html">Pwn from blabla</a></li><li class="chapter-item affix "><li class="part-title">ROP Emporium</li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/ret2win_challenge.html">ret2win - chall 1</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/split_challenge.html">split - chall 2</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/callme_challenge.html">callme - chall 3</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/write4_challenge.html">write4 - chall 4</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/badchars_challenge.html">badchars - chall 5</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/pivot_challenge.html">pivot - chall 7</a></li><li class="chapter-item "><a href="../../blogs/PWN/ROP_Emporium/ret2csu_challenge.html">ret2csu - chall 8</a></li><li class="chapter-item affix "><li class="part-title">Pwnable.tw</li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/start_challenge.html">start</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/orw_challenge.html">orw</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/calc_challenge.html">calc</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/3x17_challenge.html">3x17</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/dubblesort_challenge.html">dubblesort</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/silver_bullet_challenge.html">silver_bullet</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwnable_tw/applestore_challenge.html">applestore</a></li><li class="chapter-item affix "><li class="part-title">Pwn_Pico</li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/herelibc_challenge.html">Here's a libc</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/hijacking_challenge.html">hijacking</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/fermat_strins_challenge.html">fermat_strings</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_Pico/Guessgame_challenge.html">Guessgame</a></li><li class="chapter-item affix "><li class="part-title">Pwn from blabla</li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/handy_shellcode_challenge.html">handy shellcode</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/pwn07_challenge.html">pwn07 - ret2libc vs ROP</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/got_formatstring_challenge.html">GOT overwrite with format string</a></li><li class="chapter-item "><a href="../../blogs/PWN/Pwn_from_blabla/training.html">training</a></li><li class="chapter-item affix "><li class="part-title">Assembly</li><li class="chapter-item "><a href="../../blogs/Assembly/ASM.html">ASM</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_1.html">Session 1</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_2.html">Session 2</a></li><li class="chapter-item "><a href="../../blogs/Assembly/Session_3.html">Session 3</a></li><li class="chapter-item affix "><li class="part-title">RE_PicoCTF</li><li class="chapter-item "><a href="../../blogs/RE/RE.html">RE</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_0.html">ARMssembly 0</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_1.html">ARMssembly 1</a></li><li class="chapter-item "><a href="../../blogs/RE_Pico/ARMssembly_2.html">ARMssembly 2</a></li><li class="chapter-item affix "><li class="part-title">Documents from everywhere</li><li class="chapter-item "><a href="../../blogs/Documents/troubleshooting.html">Troubleshooting</a></li><li class="chapter-item "><a href="../../blogs/Documents/study.html">Study</a></li><li class="chapter-item "><a href="../../blogs/Documents/important_concept.html">Important Concepts</a></li><li class="chapter-item "><a href="../../blogs/Documents/basic_SQL.html">MySQL</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hjn4 Blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="terraform-module-create-vpc-on-aws"><a class="header" href="#terraform-module-create-vpc-on-aws">Terraform Module: Create VPC on AWS</a></h1>
<ul>
<li><a href="#create-vpc-non-module">Create VPC non Module</a>
<ul>
<li><a href="#get-started">Get Started</a></li>
<li><a href="#reviewing-knowledge">Reviewing knowledge</a></li>
<li><a href="#create-vpc">Create VPC</a></li>
<li><a href="#create-subnet">Create Subnet</a></li>
<li><a href="#create-public-private-subnet">Create public, private subnet</a></li>
<li><a href="#create-internet-gateway">Create Internet Gateway</a></li>
<li><a href="#create-route-table-attach-internet-gateway">Create Route Table attach Internet Gateway</a></li>
<li><a href="#attach-route-table-to-public-subnets">Attach Route Table to Public Subnets</a></li>
<li><a href="#create-nat-gateway">Create Nat Gateway</a></li>
<li><a href="#create-route-table-attach-nat-gateway">Create Route Table attach Nat Gateway</a></li>
<li><a href="#attach-route-table-to-private-subnets">Attach Route Table to Private Subnets</a></li>
<li><a href="#full-code">Full code</a></li>
</ul>
</li>
<li><a href="#module">Module</a>
<ul>
<li><a href="#using-module">Using module</a></li>
<li><a href="#write-module">Write module</a>
<ul>
<li><a href="#create-vpcvariablestf">Create /vpc/variables.tf</a></li>
<li><a href="#upate-vpcmaintf">Upate /vpc/main.tf</a></li>
<li><a href="#update-maintf">Update main.tf</a></li>
</ul>
</li>
<li><a href="#publish-module">Publish module</a></li>
</ul>
</li>
</ul>
<h2 id="create-vpc-non-module"><a class="header" href="#create-vpc-non-module">Create VPC non Module</a></h2>
<h3 id="get-started"><a class="header" href="#get-started">Get Started</a></h3>
<p>Đầu tiên tạo file main.tf:</p>
<pre><code class="language-sh">provider &quot;aws&quot; {
  region = &quot;ap-southeast-1&quot;
}

</code></pre>
<blockquote>
<p>terraform init</p>
</blockquote>
<h3 id="reviewing-knowledge"><a class="header" href="#reviewing-knowledge">Reviewing knowledge</a></h3>
<ul>
<li><strong>VPC</strong>: Là một service cho phép tạo mạng ảo, có thể control network in/out của mạng đó. Bên trong nó chứa các service khác, như 1 network on-premise</li>
<li><strong>Internet Gateway</strong>: là cánh cửa giúp access 2 chiều từ internet vào trong các service bên trong VPC và ngược lại</li>
<li><strong>Nat Gateway</strong>: là cánh cửa tuy nhiên chỉ có phép service trong VPC access ra ngoài internet, không accept chiều ngược lại</li>
<li><strong>Route Table</strong>: Định tuyến traffic trong subnet hoặc gateway sẽ được điều hướng đi đâu. Route Table sẽ quyết định một subnet sẽ là Private hay Public. Subnet được gọi là Public khi có route đi tới Internet Gateway và ngược lại.</li>
</ul>
<h3 id="create-vpc"><a class="header" href="#create-vpc">Create VPC</a></h3>
<pre><code class="language-sh">provider &quot;aws&quot; {
  region = &quot;ap-southeast-1&quot;
}

resource &quot;aws_vpc&quot; &quot;vpc&quot; {
  cidr_block           = &quot;10.0.0.0/16&quot;
  enable_dns_hostnames = true

  tags = {
    &quot;Name&quot; = &quot;custom&quot;
  }
}

</code></pre>
<ul>
<li>Ở trên ta sẽ tạo một VPC mới với CIDR là <em>10.0.0.0/16</em> và tên là <em>Custom</em>. CIDR của VPC sẽ có các giá trị nằm trong khoảng sau:
<ul>
<li>10.0.0.0/16 -&gt; 10.0.0.0/28</li>
<li>172.16.0.0/16 -&gt; 172.16.0.0/28</li>
<li>192.168.0.0/16 -&gt; 192.168.0.0/28</li>
</ul>
</li>
</ul>
<h3 id="create-subnet"><a class="header" href="#create-subnet">Create Subnet</a></h3>
<ul>
<li>Subnet sẽ chia VPC thành nhiều sub network nhỏ hơn. Mỗi subnet sẽ nằm trong một AZ. Và các service của ta sẽ được launch ở trong subnet này.</li>
</ul>
<pre><code class="language-sh">#...
resource &quot;aws_subnet&quot; &quot;private_subnet_2a&quot; {
  vpc_id     = aws_vpc.vpc.id
  cidr_block = &quot;10.0.1.0/24&quot;
  availability_zone = &quot;ap-southeast-1a&quot;

  tags = {
    &quot;Name&quot; = &quot;private-subnet&quot;
  }
}

</code></pre>
<h3 id="create-public-private-subnet"><a class="header" href="#create-public-private-subnet">Create public, private subnet</a></h3>
<pre><code class="language-sh">...
locals {
  private  = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]
  public = [&quot;10.0.4.0/24&quot;, &quot;10.0.5.0/24&quot;, &quot;10.0.6.0/24&quot;]
  zone    = [&quot;ap-southeast-1a&quot;, &quot;ap-southeast-1b&quot;, &quot;ap-southeast-1c&quot;]
}

resource &quot;aws_subnet&quot; &quot;private_subnet&quot; {
  count = length(local.private)

  vpc_id            = aws_vpc.vpc.id
  cidr_block        = local.private[count.index]
  availability_zone = local.zone[count.index % length(local.zone)]

  tags = {
    &quot;Name&quot; = &quot;private-subnet&quot;
  }
}

resource &quot;aws_subnet&quot; &quot;public_subnet&quot; {
  count = length(local.public)

  vpc_id            = aws_vpc.vpc.id
  cidr_block        = local.public[count.index]
  availability_zone = local.zone[count.index % length(local.zone)]

  tags = {
    &quot;Name&quot; = &quot;public-subnet&quot;
  }
}

</code></pre>
<h3 id="create-internet-gateway"><a class="header" href="#create-internet-gateway">Create Internet Gateway</a></h3>
<pre><code class="language-sh">...
resource &quot;aws_internet_gateway&quot; &quot;ig&quot; {
  vpc_id = aws_vpc.vpc.id

  tags = {
    &quot;Name&quot; = &quot;custom&quot;
  }
}

</code></pre>
<h3 id="create-route-table-attach-internet-gateway"><a class="header" href="#create-route-table-attach-internet-gateway">Create Route Table attach Internet Gateway</a></h3>
<pre><code class="language-sh">...
resource &quot;aws_internet_gateway&quot; &quot;ig&quot; {
  vpc_id = aws_vpc.vpc.id

  tags = {
    &quot;Name&quot; = &quot;custom&quot;
  }
}

resource &quot;aws_route_table&quot; &quot;public&quot; {
  vpc_id = aws_vpc.vpc.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_internet_gateway.ig.id
  }

  tags = {
    &quot;Name&quot; = &quot;public&quot;
  }
}


</code></pre>
<h3 id="attach-route-table-to-public-subnets"><a class="header" href="#attach-route-table-to-public-subnets">Attach Route Table to Public Subnets</a></h3>
<pre><code class="language-sh">#...
resource &quot;aws_route_table_association&quot; &quot;public_association&quot; {
  for_each       = { for k, v in aws_subnet.public_subnet : k =&gt; v }
  subnet_id      = each.value.id
  route_table_id = aws_route_table.public.id
}

</code></pre>
<h3 id="create-nat-gateway"><a class="header" href="#create-nat-gateway">Create Nat Gateway</a></h3>
<pre><code class="language-sh">...
resource &quot;aws_eip&quot; &quot;nat&quot; {
  vpc = true
}

resource &quot;aws_nat_gateway&quot; &quot;public&quot; {
  depends_on = [aws_internet_gateway.ig]

  allocation_id = aws_eip.nat.id
  subnet_id     = aws_subnet.public_subnet[0].id

  tags = {
    Name = &quot;Public NAT&quot;
  }
}

</code></pre>
<h3 id="create-route-table-attach-nat-gateway"><a class="header" href="#create-route-table-attach-nat-gateway">Create Route Table attach Nat Gateway</a></h3>
<pre><code class="language-sh">...
resource &quot;aws_route_table&quot; &quot;private&quot; {
  vpc_id = aws_vpc.vpc.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_nat_gateway.public.id
  }

  tags = {
    &quot;Name&quot; = &quot;private&quot;
  }
}

</code></pre>
<h3 id="attach-route-table-to-private-subnets"><a class="header" href="#attach-route-table-to-private-subnets">Attach Route Table to Private Subnets</a></h3>
<pre><code class="language-sh">...
resource &quot;aws_route_table_association&quot; &quot;private_association&quot; {
  for_each       = { for k, v in aws_subnet.private_subnet : k =&gt; v }
  subnet_id      = each.value.id
  route_table_id = aws_route_table.private.id
}

</code></pre>
<h3 id="full-code"><a class="header" href="#full-code">Full code</a></h3>
<p><a href="https://github.com/Hjn4Pwn/Terraform-file/tree/master/create-vpc-module">Full code</a></p>
<h2 id="module"><a class="header" href="#module">Module</a></h2>
<ul>
<li>Một module cơ bản sẽ gồm 3 file sau đây:
<ul>
<li><strong>main.tf</strong> chứa code.</li>
<li><strong>variables.tf</strong> chứa input vào của module.</li>
<li><strong>outputs.tf</strong> chưa giá trị đầu ra của module.</li>
</ul>
</li>
</ul>
<h3 id="using-module"><a class="header" href="#using-module">Using module</a></h3>
<ul>
<li>Để sử dụng module, ta dùng resource tên là module như sau:</li>
</ul>
<pre><code class="language-sh">module &lt;module_name&gt; {
  source = &lt;source&gt;
  version = &lt;version&gt;

  input_one = &lt;input_one&gt;
  input_two = &lt;input_two&gt;
}

</code></pre>
<ul>
<li><strong>source</strong>: có thể là dường dẫn local hoặc một url trên mạng</li>
<li><strong>version</strong>: chỉ định version của module</li>
<li><strong>input_one</strong>: là các giá trị input ta định nghĩa trong file variables.tf.</li>
</ul>
<h3 id="write-module"><a class="header" href="#write-module">Write module</a></h3>
<ul>
<li>Ta tạo folder với cấu trúc như sau.</li>
</ul>
<pre><code class="language-sh">.
├── main.tf
└── vpc
    ├── main.tf
    ├── outputs.tf
    └── variables.tf

</code></pre>
<ul>
<li>Ta cần xác định các giá trị động mà ta sẽ truyển vào module</li>
<li>Với code trên thì ta có các giá trị động là:
<ul>
<li>VPC CIDR Block</li>
<li>Region</li>
<li>AZ</li>
<li>Subnet</li>
</ul>
</li>
</ul>
<h4 id="create-vpcvariablestf"><a class="header" href="#create-vpcvariablestf">Create /vpc/variables.tf</a></h4>
<pre><code class="language-sh">variable &quot;region&quot; {
  type    = string
  default = &quot;ap-southeast-1&quot;
}

variable &quot;vpc_cidr_block&quot; {
  type    = string
  default = &quot;10.0.0.0/16&quot;
}

variable &quot;private_subnet&quot; {
  type = list(string)
}

variable &quot;public_subnet&quot; {
  type = list(string)
}

variable &quot;AZ&quot; {
  type = list(string)
}

</code></pre>
<h4 id="upate-vpcmaintf"><a class="header" href="#upate-vpcmaintf">Upate /vpc/main.tf</a></h4>
<pre><code class="language-sh">provider &quot;aws&quot; {
  region = var.region
}

# Create VPC
resource &quot;aws_vpc&quot; &quot;vpc&quot; {
  cidr_block           = var.vpc_cidr_block
  enable_dns_hostnames = true

  tags = {
    &quot;Name&quot; = &quot;custom&quot;
  }
}

# Create public, private subnet
locals {
  private = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]
  public  = [&quot;10.0.4.0/24&quot;, &quot;10.0.5.0/24&quot;, &quot;10.0.6.0/24&quot;]
  zone    = [&quot;ap-southeast-1a&quot;, &quot;ap-southeast-1b&quot;, &quot;ap-southeast-1c&quot;]
}

resource &quot;aws_subnet&quot; &quot;private_subnet&quot; {
  count = length(var.private_subnet)

  vpc_id            = aws_vpc.vpc.id
  cidr_block        = var.private_subnet[count.index]
  availability_zone = var.AZ[count.index % length(var.AZ)]

  tags = {
    &quot;Name&quot; = &quot;private-subnet&quot;
  }
}

resource &quot;aws_subnet&quot; &quot;public_subnet&quot; {
  count = length(var.public_subnet)

  vpc_id            = aws_vpc.vpc.id
  cidr_block        = var.public_subnet[count.index]
  availability_zone = var.AZ[count.index % length(var.AZ)]

  tags = {
    &quot;Name&quot; = &quot;public-subnet&quot;
  }
}

# Create Internet Gateway
resource &quot;aws_internet_gateway&quot; &quot;ig&quot; {
  vpc_id = aws_vpc.vpc.id

  tags = {
    &quot;Name&quot; = &quot;custom&quot;
  }
}

# Create Route Table attach Internet Gateway
resource &quot;aws_route_table&quot; &quot;public&quot; {
  vpc_id = aws_vpc.vpc.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_internet_gateway.ig.id
  }

  tags = {
    &quot;Name&quot; = &quot;public&quot;
  }
}

# Attach Route Table to Public Subnets
resource &quot;aws_route_table_association&quot; &quot;public_association&quot; {
  for_each       = { for k, v in aws_subnet.public_subnet : k =&gt; v }
  subnet_id      = each.value.id
  route_table_id = aws_route_table.public.id
}

# Create Nat Gateway
resource &quot;aws_eip&quot; &quot;nat&quot; {
  domain = &quot;vpc&quot;
}

resource &quot;aws_nat_gateway&quot; &quot;public&quot; {
  depends_on = [aws_internet_gateway.ig]

  allocation_id = aws_eip.nat.id
  subnet_id     = aws_subnet.public_subnet[0].id

  tags = {
    Name = &quot;Public NAT&quot;
  }
}

# Create Route Table attach Nat Gateway
resource &quot;aws_route_table&quot; &quot;private&quot; {
  vpc_id = aws_vpc.vpc.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_nat_gateway.public.id
  }

  tags = {
    &quot;Name&quot; = &quot;private&quot;
  }
}

# Attach Route Table to Private Subnets
resource &quot;aws_route_table_association&quot; &quot;private_association&quot; {
  for_each       = { for k, v in aws_subnet.private_subnet : k =&gt; v }
  subnet_id      = each.value.id
  route_table_id = aws_route_table.private.id
}

</code></pre>
<h4 id="update-maintf"><a class="header" href="#update-maintf">Update main.tf</a></h4>
<pre><code class="language-sh">provider &quot;aws&quot; {
  region = &quot;ap-southeast-1&quot;
}

module &quot;VPC&quot; {
  source         = &quot;./VPC&quot;
  vpc_cidr_block = &quot;10.0.0.0/16&quot;
  private_subnet = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]
  public_subnet  = [&quot;10.0.4.0/24&quot;, &quot;10.0.5.0/24&quot;, &quot;10.0.6.0/24&quot;]
  AZ             = [&quot;ap-southeast-1a&quot;, &quot;ap-southeast-1b&quot;, &quot;ap-southeast-1c&quot;]
}

</code></pre>
<h3 id="publish-module"><a class="header" href="#publish-module">Publish module</a></h3>
<ul>
<li>
<p>Tạo repo trên github:</p>
<ul>
<li>Name syntax: <strong>terraform-&lt;provider&gt;-&lt;name&gt;</strong>
<ul>
<li>Ex: <em>terraform-aws-vpc</em></li>
</ul>
</li>
<li>Gắn tag syntax: <strong>v&lt;XXXXX&gt;</strong>
<ul>
<li>Ex: <em>v0.0.1</em></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Truy cập <a href="https://registry.terraform.io">Registry</a> bằng github account</p>
</li>
<li>
<p>Vào <strong>Public</strong> -&gt; <strong>Module</strong>:
<img src="./image/publish_module.png" alt="alt text" /></p>
</li>
<li>
<p>Sau đó sẽ có hướng dẫn dùng module đó:
<img src="./image/instruction_usemodule.png" alt="alt text" /></p>
</li>
<li>
<p>Và giờ ta chỉ việc dùng config tí:</p>
</li>
</ul>
<pre><code class="language-sh">  source  = &quot;Hjn4Pwn/vpc/aws&quot;
  version = &quot;0.0.1&quot;

  region         = &quot;ap-southeast-1&quot;
  vpc_cidr_block = &quot;10.0.0.0/16&quot;
  private_subnet = [&quot;10.0.1.0/24&quot;, &quot;10.0.2.0/24&quot;, &quot;10.0.3.0/24&quot;]
  public_subnet  = [&quot;10.0.4.0/24&quot;, &quot;10.0.5.0/24&quot;, &quot;10.0.6.0/24&quot;]
  AZ             = [&quot;ap-southeast-1a&quot;, &quot;ap-southeast-1b&quot;, &quot;ap-southeast-1c&quot;]
}

</code></pre>
<p><em><strong>Tuy nhiên đã có sẵn các module như này, cơ mà còn chi tiết hơn nữa nên là, trc khi tạo gì đó ta có thể search module mà dùng thay vì ngồi gõ sml</strong></em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../blogs/Terraform/functional_pro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../blogs/Jenkins/install_by_docker.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../blogs/Terraform/functional_pro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../blogs/Jenkins/install_by_docker.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
